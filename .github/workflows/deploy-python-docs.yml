name: Deploy Docs (Landing + Python + C++)

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      - run: pip install mkdocs-material ghp-import

      # Clean output folder at repo root
      - run: |
          rm -rf site
          mkdir -p site

      # 1) Build Python MkDocs into /python/
      - run: |
          mkdocs build -f SDK/docs/python/mkdocs.yml -d "${GITHUB_WORKSPACE}/site/python" --clean
          test -f site/python/index.html

      # 2) Copy C++ HTML (Doxygen output) into /cpp/
      - run: |
          mkdir -p "${GITHUB_WORKSPACE}/site/cpp"
          cp -r SDK/docs/cpp/* "${GITHUB_WORKSPACE}/site/cpp/"
          test -f site/cpp/index.html
          
      # 3) Copy Maker Guide HTML into /maker/
      - run: |
          mkdir -p "${GITHUB_WORKSPACE}/site/maker"
          cp -r Guide/web/* "${GITHUB_WORKSPACE}/site/maker/"
          test -f site/maker/index.html          

      # 4) Copy landing page into site root (/)
      - run: |
          cp -r SDK/docs/landing/* "${GITHUB_WORKSPACE}/site/"
          test -f site/index.html

      # Deploy everything to gh-pages
      - run: ghp-import -n -p -f site
